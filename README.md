# AI School

[English](README_EN.md) | 中文

> 用 AI 模拟一所学校，观察学生如何成长。

## 愿景

每个孩子都是独一无二的。但我们的教育系统很少有机会真正理解——一个内向的孩子在什么样的社交环境中会打开自己，一个充满好奇心的学生在哪个转折点找到了人生方向。

**AI School 想做的事很简单：让 AI 学生在虚拟校园里「活」起来，然后观察他们。**

每个 AI 学生拥有独立的人格、记忆和目标。他们上课、交友、争论、迷茫、成长——所有行为不是预编程的，而是从个体交互中自然**涌现**的。我们通过观察这些涌现行为，研究学生身心发展与职业匹配的规律。

这不是一个教育游戏，而是一个**研究工具**。我们相信，理解了虚拟学生的成长规律，就能更好地陪伴真实的孩子。

## 快速开始

```bash
# 1. 克隆项目
git clone https://github.com/your-org/ai-school.git && cd ai-school

# 2. 配置环境变量
cp .env.example .env
# 编辑 .env，填入 DeepSeek 和智谱 API Key

# 3. 启动基础设施
docker compose up -d

# 4. 构建前端
cd frontend && npm install && npx vite build && cd ..

# 5. 启动服务
cargo run --bin ai-school-api

# 6. 打开浏览器
open http://localhost:3000
```

详细配置步骤见 [SETUP.md](SETUP.md)。

## 演示视频

<video src="assert/demo.mp4" controls width="100%"></video>

## 界面预览

```
┌──────────────────────────────────────────────────────────┐
│  [⚡] AI SCHOOL    [▶ Start] [⏸ Pause] [1x ▾]    Day 15 │
├──────────┬──────────────────────────┬────────────────────┤
│          │                          │                    │
│  Agent   │    2D Campus Map         │   Detail / Chat    │
│  List    │    (React-Konva)         │   Panel            │
│          │                          │                    │
│  小明    │  ┌────┐  ┌────┐         │  [MBTI] ESTP       │
│  ESTP    │  │教室│  │图书│         │  [情绪] ██████░    │
│  学习中  │  └────┘  └────┘         │  [能力] ████░░     │
│          │    @  @  @               │                    │
│  小红    │  ┌────┐  ┌────┐         │  "老师好，我最近   │
│  INFJ    │  │操场│  │食堂│         │   在考虑..."       │
│  社交中  │  └────┘  └────┘         │  [发送消息...]     │
│          │                          │                    │
├──────────┴──────────────────────────┴────────────────────┤
│  [Intervention]  难度:████░░  社交:██████░  [Events ▾]   │
└──────────────────────────────────────────────────────────┘
```

## 两个阶段

| 阶段 | 目标 | 形态 |
|------|------|------|
| **Phase 1** | 研究学生身心发展与职业匹配规律 | AI 学校仿真平台（研究工具） |
| **Phase 2** | 将研究成果转化为真实学生的陪伴 | 学生陪伴机器人（面向用户的产品） |

## 架构概览

系统由 6 大模块组成，Phase 1 聚焦前 5 个：

```
AI School
├── M1. 学生 Agent 系统      ← 人格、志向、认知行为框架
├── M2. 学校世界系统          ← 课程、社交、环境与时间
├── M3. 演化引擎             ← 自主演化、用户干预、事件生成
├── M4. 记忆与成长系统        ← 多层记忆、身心追踪、人格演变
├── M5. 研究与分析平台        ← 轨迹可视化、职业匹配、实验对照
└── M6. 学生陪伴机器人        ← Phase 2：画像建模、健康陪伴、职业引导
```

## 技术栈

### 后端

- **语言**：Rust（并发安全、长期运行稳定性、严格类型系统）
- **Web 框架**：Axum（HTTP + WebSocket）
- **LLM**：DeepSeek（Agent 决策 + GM 仲裁）+ 智谱 AI（记忆向量化）
- **存储**：PostgreSQL（结构化数据）+ Qdrant（向量记忆检索）
- **架构**：Cargo Workspace 8 个 crate，模块间通过 trait 抽象解耦

### 前端

- **框架**：React + TypeScript + Vite
- **2D 渲染**：React-Konva（Canvas 校园地图）
- **状态管理**：Zustand + WebSocket 实时同步
- **样式**：Tailwind CSS（暗色研究实验室主题）
- **图表**：Recharts

### 数据流

```
用户操作 → REST API → 仿真引擎 → LLM 调用 → 状态更新
                                              ↓
                              WebSocket ← 广播更新 → 前端实时渲染
```

## 研究基础

架构设计基于 **34 篇论文的系统性研究**，覆盖五大方向：

### 生成式智能体架构

从 2023 年 Stanford 的 Smallville 实验（25 个 AI 居民在虚拟小镇自主生活）开始，研究社区逐步验证了三条核心公理：

1. **行为 = f(记忆, 情境, 目标)** — 智能体的每个行动由累积记忆、当前感知和内在人格共同驱动
2. **社会行为是涌现属性** — 信息扩散、关系形成、活动协调等群体行为不是预编程的，而是从个体交互中自然产生
3. **记忆是认知基础设施** — 消融实验表明，移除记忆后行为可信度下降 8.16 个标准差

后续 1,000 People (2024) 将仿真扩展到真实个体，AgentSociety (2025) 推至 10,000+ 智能体 / 500 万次交互，结果与真实世界实验结论高度一致。

### 记忆系统演进

记忆架构经历了四代范式转变：

| 代际 | 范式 | 代表工作 | 核心突破 |
|------|------|----------|----------|
| 第一代 | 扁平记忆流 | Generative Agents (2023) | 时效性 × 重要性 × 相关性的加权检索 |
| 第二代 | 互联知识网络 | A-MEM (2025) | 记忆不再是静态存档，而是持续精炼的 Zettelkasten 网络 |
| 第三代 | 多层逻辑网络 | Hindsight (2025) | 区分事实 / 信念 / 观察 / 经历，准确率从 39% → 91.4% |
| 第四代 | 生成式潜在记忆 | MemGen (ICLR 2026) | 记忆编织进推理过程，自发涌现出规划记忆和工作记忆 |

AI School 采用分层记忆架构（感知→短期→长期→语义），吸收了第二、三代的核心设计。

### 人格与行为

两条技术路线并存：Prompt 方法（即时生效，但只改变表层语言风格）和训练方法（深层植入，BIG5-CHAT 证明显著优于 Prompt）。MBTI 适合直觉型角色设定，Big Five 适合精确行为预测——AI School 以 MBTI 4 维连续分数为基础框架。

关键警示：Social Alignment 研究用 Milgram 服从实验证明，Prompt 可能只改变智能体的措辞而非深层决策。这要求我们对人格一致性保持持续验证。

### 涌现行为

已观察到三类涌现现象，均无需预编程：

- **个性自发分化** — 同质智能体在社区交互中自主发展出差异化个性
- **竞争中的自发合作** — 竞争场景中智能体渐进地"发现"合作策略，与人类行为数据高度一致
- **社交纽带形成** — 智能体发展出的网络结构镜像真实在线社区

NetworkGames (2025) 进一步揭示：宏观合作水平无法从双人交互预测——网络拓扑与人格分布**共同决定**涌现结果。这意味着仿真规模本身会带来质变。

### 已知挑战

- **长期一致性衰减** — LIFELONG-SOTOPIA 发现所有模型在 40+ 轮交互后表现持续下降，记忆改善有帮助但不充分
- **涌现不可预测性** — 大规模仿真结果难以先验推断
- **对齐偏差** — 安全训练使模型倾向于"好性格"，压制负面人格表达，导致人格空间覆盖不完整

详见 [`docs/research/`](docs/research/) 目录。

## 文档

| 文档 | 说明 |
|------|------|
| [`SETUP.md`](SETUP.md) | 从零开始的环境配置与启动指南 |
| [`docs/research/`](docs/research/) | 34 篇论文的研究综述与深度分析 |
| [`docs/prd/`](docs/prd/) | 产品需求框架与各模块 PRD |
| [`docs/adr/`](docs/adr/) | 架构决策记录（ADR） |

## 开发状态

**Phase 1a MVP** — 核心仿真引擎 + Web 交互层已完成：

- [x] M1: 学生 Agent 系统（人格、认知、职业）
- [x] M2: 学校世界系统（校园、时间、课程、社交）
- [x] M3: 演化引擎（仿真循环、GM 仲裁、干预系统）
- [x] M4: 记忆系统（多层记忆、向量检索、反思触发）
- [x] LLM 集成（DeepSeek 补全 + 智谱嵌入）
- [x] HTTP/WebSocket API（15 个端点）
- [x] Web UI（2D 校园地图、Agent 管理、对话、干预、数据导出）
- [x] M5: 研究分析平台（图表可视化、实验对照）
- [x] 持久化存储（PostgreSQL + Qdrant 集成）
- [ ] 大规模仿真优化（50+ Agent）

## License

MIT

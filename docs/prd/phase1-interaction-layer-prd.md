# Product Requirements Document: Phase 1 用户交互层

**Version**: 1.0
**Date**: 2026-02-16
**Author**: Sarah (Product Owner)
**Quality Score**: 85/100
**Relates to**: [需求框架](./requirements-framework.md) — D7 决策点 + M3.2 用户干预 + M5.1 可视化

---

## Executive Summary

AI School Phase 1 是一个仿真研究平台，需要一个交互层让研究者能够配置学生 Agent、观察其在校园中的自主行为、在演化过程中进行干预、并分析发展结果。同时，该交互层需支持向非技术人员（教育专家、投资人）进行直觉化演示。

经过方案评估，决定采用 **Web 应用** 作为主交互界面，融合「上帝视角」控制台与「参与者视角」对话面板。核心视觉元素是一张 **现代风格的 2D 校园地图**，实时呈现 5-10 个学生 Agent 的移动与互动。干预支持三种模式：对话式、参数调整、事件触发。社交软件对接作为第二阶段增强。

这一决策的依据是：Web 应用能够同时满足「全局控制 + 角色参与 + 数据分析 + 非技术用户演示」四大需求，是当前阶段投入产出比最优的方案。

---

## Problem Statement

**Current Situation**: AI School 仿真引擎（M1-M4 模块）需要一个用户触点。没有交互层，研究者无法：
- 直觉化地配置 Agent 人格与目标
- 实时观察 Agent 群体的社交动态与学习行为
- 在仿真过程中以多种方式进行干预
- 向非技术利益相关者展示研究进展

**Proposed Solution**: 构建一个 Web 应用，包含 2D 校园地图、仿真控制台、对话面板和数据分析视图，通过 API 与后端仿真引擎通信。

**Business Impact**:
- 研究效率：从"读日志猜行为"提升为"看地图懂动态"
- 利益相关者沟通：让教育专家和投资人能亲自体验 AI School
- Phase 2 准备：验证交互模式，为陪伴机器人产品奠定 UX 基础

---

## Success Metrics

**Primary KPIs:**

| 指标 | 目标值 | 测量方式 |
|------|--------|---------|
| 仿真可观察性 | 用户能通过 2D 地图实时识别每个 Agent 的位置、状态和社交关系 | 观察测试：用户能在 30s 内描述任意 Agent 的当前活动 |
| 干预响应性 | 三种干预方式均能在 5s 内反映到 Agent 行为变化 | 干预操作→行为变化的端到端延迟测量 |
| 非技术用户可用性 | 非技术人员在 5 分钟引导后能独立完成"观察 + 简单干预"流程 | 用户测试：3 名非技术用户的任务完成率 > 80% |
| 演示效果 | 10 分钟演示能让观众理解 AI School 的核心价值 | 演示后问卷：理解度评分 > 4/5 |

**Validation**: MVP 上线后进行 3 轮用户测试，每轮 3-5 人，迭代优化。

---

## User Personas

### Primary: 研究者 (Curtis)

- **Role**: CEO / 首席研究员
- **Goals**: 高效配置实验、深度观察 Agent 行为涌现、精确干预、提取研究洞察
- **Pain Points**: 纯日志/数据难以直觉理解群体动态，干预缺乏即时反馈
- **Technical Level**: Advanced（有编程能力）
- **使用频率**: 每日使用，长时间观察

### Secondary: 利益相关者 (教育专家 / 投资人)

- **Role**: 外部合作方 / 潜在投资人
- **Goals**: 快速理解 AI School 的能力与研究价值
- **Pain Points**: 技术门槛高，无法亲自体验系统
- **Technical Level**: Novice（无编程能力）
- **使用频率**: 演示场景，每次 10-30 分钟

---

## User Stories & Acceptance Criteria

### Story 1: 配置并启动仿真

**As a** 研究者
**I want to** 在 Web 界面中创建 5-10 个学生 Agent，设定各自的 MBTI 人格和理想职业，然后启动仿真
**So that** 我可以快速建立一个差异化的学生群体进行研究

**Acceptance Criteria:**
- [ ] 可通过表单创建 Agent，必填字段：名称、MBTI 四维分数（滑块）、理想职业（下拉/自由输入）
- [ ] 支持一键生成随机 Agent 群体（快速启动）
- [ ] 可保存/加载 Agent 配置方案（实验可复现）
- [ ] 点击「启动仿真」后，2D 地图上出现所有 Agent 并开始自主行动

### Story 2: 通过 2D 地图观察 Agent 行为

**As a** 研究者或利益相关者
**I want to** 在 2D 校园地图上实时看到所有 Agent 的位置、当前活动和社交互动
**So that** 我可以直觉化地理解群体动态和个体差异

**Acceptance Criteria:**
- [ ] 2D 地图展示校园功能区域（教室、操场、图书馆、食堂、宿舍等）
- [ ] 每个 Agent 以头像/图标显示在地图上，带有名称标签
- [ ] Agent 移动有平滑动画，而非瞬移
- [ ] 两个 Agent 互动时有视觉提示（对话气泡、连线等）
- [ ] 点击任意 Agent 可查看详情面板（人格、状态、近期事件、心理指标）
- [ ] 支持仿真速度控制（暂停、1x、2x、5x、10x）
- [ ] 支持时间回溯：拖动时间轴回看历史状态

### Story 3: 以角色身份与学生 Agent 对话

**As a** 研究者
**I want to** 以老师或校长的身份与某个学生 Agent 进行自然语言对话
**So that** 我可以深入了解该 Agent 的想法，或通过对话影响其行为

**Acceptance Criteria:**
- [ ] 点击地图上的 Agent 或从列表中选择后，可打开对话面板
- [ ] 用户可选择角色身份（老师/校长/辅导员）
- [ ] Agent 根据自身人格、记忆和当前状态进行回应
- [ ] 对话内容被记录到 Agent 的记忆系统中，影响后续行为
- [ ] 对话面板不阻塞仿真主界面（侧边栏或浮窗）

### Story 4: 调整环境参数与触发事件

**As a** 研究者
**I want to** 在仿真运行中调整环境参数（课程难度、社交机会频率等）或手动触发特定事件
**So that** 我可以研究不同条件下 Agent 行为的变化

**Acceptance Criteria:**
- [ ] 控制面板提供环境参数滑块（课程难度、社交密度、竞争压力等）
- [ ] 参数调整实时生效，地图上可观察到行为变化
- [ ] 事件触发菜单提供预设事件类型（期中考试、社团招新、友谊冲突、意外机遇等）
- [ ] 可指定事件的影响范围（全局/特定 Agent/特定群组）
- [ ] 所有干预操作有时间戳日志，支持实验复现

### Story 5: 查看发展数据与分析

**As a** 研究者
**I want to** 查看每个 Agent 的身心发展曲线、人格变化轨迹和职业匹配度
**So that** 我可以从数据层面分析仿真结果

**Acceptance Criteria:**
- [ ] 数据面板展示个体 Agent 的时间序列图（学业、社交、心理指标）
- [ ] 展示群体层面的统计概览（平均值、分布、聚类）
- [ ] 人格雷达图展示 MBTI 四维的初始值 vs 当前值
- [ ] 职业匹配度评分，对比理想职业与实际发展方向
- [ ] 支持数据导出（JSON/CSV）用于外部分析

---

## Functional Requirements

### F1: 2D 校园地图（核心视觉）

**Description**: 现代风格的 2D 平面校园地图，作为主界面的核心区域。

**校园功能区域:**
- 教学区：多间教室（不同学科）
- 社交区：操场、食堂、休息区
- 学习区：图书馆、自习室
- 生活区：宿舍
- 活动区：社团活动室、礼堂

**视觉规格:**
- 风格：现代简约 2D 平面设计，清晰的功能区域色块划分
- Agent 表示：圆形头像 + 名称，颜色编码 MBTI 类型
- 交互提示：对话气泡、移动路径虚线、社交连线
- 状态指示：Agent 头像周围的状态环（学习中/社交中/休息中/困扰中）

**交互:**
- 缩放和平移
- 点击 Agent 打开详情
- 点击区域查看该区域内的 Agent 列表
- 右键菜单：与该 Agent 对话 / 触发事件

### F2: 仿真控制台

**Description**: 仿真的启动、暂停、速度控制和时间管理。

**功能:**
- 启动/暂停/停止仿真
- 速度控制：1x / 2x / 5x / 10x / 最大速度
- 时间显示：仿真日期时间（学期/周/天/时段）
- 时间轴：可拖动回看历史状态
- 仿真状态指示：当前轮次、已运行时长、Agent 活跃数

### F3: Agent 配置面板

**Description**: 创建和管理学生 Agent 的配置。

**功能:**
- 创建 Agent：名称、MBTI 四维滑块（E/I, S/N, T/F, J/P 各 0-100）、理想职业、可选背景描述
- 批量生成：随机生成 N 个 Agent（可设定人格分布偏好）
- 配置方案：保存/加载/分享实验配置（JSON 格式）
- Agent 列表：查看所有 Agent 的概览和快速操作入口

### F4: 对话面板（参与者模式）

**Description**: 以角色身份与 Agent 进行自然语言交互的侧边栏。

**功能:**
- 角色选择：老师 / 校长 / 辅导员 / 自定义角色
- 对话界面：类聊天 UI，支持文字输入
- 上下文显示：对话时展示该 Agent 当前的状态摘要
- 对话历史：查看与任意 Agent 的历史对话记录
- 对话影响提示：系统提示此次对话对 Agent 产生的影响（可选显示）

### F5: 干预工具面板

**Description**: 参数调整和事件触发的控制界面。

**环境参数:**
- 课程难度（Easy / Normal / Hard）
- 社交密度（社交活动频率）
- 竞争压力（考试频率、排名公示等）
- 随机事件频率

**事件触发:**
- 预设事件库：期中考试、社团招新、运动会、友谊冲突、新同学转入、老师表扬/批评
- 自定义事件：自由文本描述 + 影响范围选择
- 事件范围：全局 / 指定 Agent / 指定区域

**干预日志:**
- 时间戳 + 干预类型 + 干预内容 + 影响 Agent 列表
- 支持导出

### F6: 数据分析视图

**Description**: 仿真数据的可视化分析界面。

**个体分析:**
- 身心发展曲线（学业成绩、社交能力、心理健康指标 vs 时间）
- 人格雷达图（MBTI 四维初始值 vs 当前值）
- 关键事件时间线（标注转折点）
- 职业匹配度评分

**群体分析:**
- Agent 关系网络图（社交连接强度）
- 指标分布直方图
- 聚类分析（自动发现行为模式相似的 Agent 群组）

**数据导出:**
- 全量数据 JSON/CSV 导出
- 分析报告自动生成（Markdown）

### Out of Scope（Phase 1 MVP 不含）

- 社交软件 Bot 对接（微信/Telegram/飞书）→ Phase 1b
- 3D 校园可视化 → 远期
- 多人协作实时编辑 → 远期
- Agent 数量 > 10 的大规模仿真 → 规模验证后扩展
- 移动端适配 → 远期
- 用户认证与权限管理 → 用户群扩大后

---

## Technical Architecture

### 分层架构

```
┌──────────────────────────────────────────────┐
│                 Web Frontend                  │
│  ┌──────────┐ ┌────────┐ ┌────────┐ ┌──────┐│
│  │ 2D Map   │ │ Chat   │ │Control │ │ Data ││
│  │ (Canvas/ │ │ Panel  │ │ Panel  │ │ View ││
│  │  SVG)    │ │        │ │        │ │      ││
│  └────┬─────┘ └───┬────┘ └───┬────┘ └──┬───┘│
│       └───────────┴──────────┴─────────┘    │
│                    │                         │
│            WebSocket + REST API              │
└────────────────────┬─────────────────────────┘
                     │
┌────────────────────┴─────────────────────────┐
│               API Gateway                     │
│  ┌──────────┐ ┌──────────┐ ┌──────────────┐ │
│  │Simulation│ │  Agent   │ │  Analytics   │ │
│  │ Control  │ │Interact  │ │     API      │ │
│  │   API    │ │   API    │ │              │ │
│  └────┬─────┘ └────┬─────┘ └──────┬───────┘ │
└───────┴─────────────┴──────────────┴─────────┘
                     │
┌────────────────────┴─────────────────────────┐
│           Simulation Engine (Backend)         │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌───────┐ │
│  │ Agent  │ │ World  │ │Memory  │ │ Event │ │
│  │ System │ │ System │ │ System │ │Engine │ │
│  │ (M1)   │ │ (M2)   │ │ (M4)   │ │ (M3) │ │
│  └────────┘ └────────┘ └────────┘ └───────┘ │
└──────────────────────────────────────────────┘
```

### 技术选型建议（待 ADR 决策）

| 层级 | 候选方案 | 考量 |
|------|---------|------|
| Frontend | React/Next.js 或 Vue/Nuxt | 生态成熟度、组件库丰富度 |
| 2D 地图渲染 | HTML5 Canvas (Pixi.js) 或 SVG (D3.js) | 5-10 Agent 规模下 SVG 足够，可交互性更好 |
| 实时通信 | WebSocket (Socket.io) | 地图状态实时推送 |
| REST API | FastAPI (Python) 或 Express (Node.js) | 与仿真引擎语言一致为佳 |
| 数据存储 | SQLite (MVP) → PostgreSQL (扩展) | 小规模研究 SQLite 足够 |

### Performance Requirements

| 指标 | 目标 | 依据 |
|------|------|------|
| 地图刷新率 | ≥ 10 FPS | 平滑动画的最低要求 |
| 对话响应 | < 5s | LLM API 调用 + Agent 思考的端到端时间 |
| 干预生效 | < 3s | 参数调整到行为变化的延迟 |
| 页面加载 | < 3s | 首屏加载时间 |
| 并发 Agent | 5-10 | MVP 规模 |

---

## MVP Scope & Phasing

### Phase 1a: MVP（最小可研究产品）

**核心交付：**
- F1: 2D 校园地图（基础区域 + Agent 显示 + 点击详情）
- F2: 仿真控制台（启动/暂停/速度控制）
- F3: Agent 配置（手动创建 + 随机生成）
- F4: 对话面板（基础对话功能）
- F5: 干预工具（环境参数 + 预设事件）
- F6: 数据视图（个体曲线 + 基础导出）

**MVP 定义**: 研究者能通过 Web 界面创建 5-10 个人格各异的学生 Agent，在 2D 校园中观察其自主行为，通过对话/参数/事件三种方式干预，并导出发展数据进行分析。

### Phase 1b: 增强

- 社交软件 Bot 对接（微信/Telegram）— 作为「参与者模式」的补充入口
- 时间回溯与回放功能
- 群体分析视图（关系网络图、聚类）
- 实验方案对比（A/B 仿真）

### Future Considerations

- 大规模仿真（50-100+ Agent）
- 3D 校园可视化
- 多用户协作
- 移动端适配

---

## Risk Assessment

| Risk | Probability | Impact | Mitigation Strategy |
|------|------------|--------|---------------------|
| LLM API 延迟导致地图更新卡顿 | High | High | 异步架构：仿真引擎批量调用 LLM，前端通过 WebSocket 接收已计算好的状态更新 |
| 2D 地图开发工作量超预期 | Med | High | 先用简化版（圆点 + 标签），验证核心交互后再美化 |
| Agent 对话质量不稳定 | High | Med | 使用固定的角色 Prompt 模板，加入人格一致性校验 |
| 非技术用户仍觉得复杂 | Med | Med | 提供「引导模式」——首次使用时的分步教程 |
| 仿真速度与可视化同步困难 | Med | Med | 高速模式下采用"关键帧"更新而非逐步动画 |

---

## Dependencies & Blockers

**Dependencies:**

| 依赖 | 说明 | 状态 |
|------|------|------|
| M1: Agent 系统 | 人格初始化与认知框架 | 需先完成 PRD |
| M2: 世界系统 | 校园结构与活动定义 | 需先完成 PRD |
| M3: 演化引擎 | 仿真循环与事件系统 | 需先完成 PRD |
| M4: 记忆系统 | Agent 记忆存储与检索 | 需先完成 PRD |
| LLM API | OpenAI/Anthropic/本地模型 | 需选型决策 (D1) |

**Known Blockers:**
- 后端仿真引擎尚未开始开发 — 交互层开发可与引擎并行，先用 Mock 数据构建 UI

---

## Appendix

### 界面布局草案

```
┌─────────────────────────────────────────────────────────┐
│  [Logo] AI School    [▶ Start] [⏸ Pause] [1x ▼]  Day 15│
├─────────────┬───────────────────────────┬───────────────┤
│             │                           │               │
│   Agent     │      2D Campus Map        │    Chat /     │
│   List      │                           │    Detail     │
│             │   ┌───┐  ┌───┐           │    Panel      │
│  [Avatar]   │   │ 🏫│  │ 📚│           │               │
│   Name      │   │教室│  │图书│          │  [Role: 老师]  │
│   MBTI      │   └───┘  └───┘           │               │
│   Status    │        👤 👤              │  Agent: 小明   │
│             │     👤    👤 👤           │  "老师好！我    │
│  [Avatar]   │   ┌───┐  ┌───┐           │   最近在考虑   │
│   Name      │   │ 🏃│  │ 🍽│           │   ..."        │
│   MBTI      │   │操场│  │食堂│          │               │
│   Status    │   └───┘  └───┘           │  [输入消息...]  │
│             │                           │               │
├─────────────┴───────────────────────────┴───────────────┤
│  [Intervention Panel]  难度: ████░░  社交: ██████░       │
│  [Trigger Event ▼]  [Data Analysis 📊]  [Export 📥]     │
└─────────────────────────────────────────────────────────┘
```

### Glossary

- **Agent**: LLM 驱动的虚拟学生角色，具有独立人格、记忆和目标
- **MBTI 四维分数**: E/I（外向/内向）、S/N（感觉/直觉）、T/F（思维/情感）、J/P（判断/知觉）各 0-100 的连续分值
- **上帝视角**: 用户从外部观察和控制整个仿真系统
- **参与者视角**: 用户以角色身份进入仿真世界与 Agent 互动
- **仿真轮次**: 仿真引擎的一个时间步长（对应仿真世界中的一个时段）

### References

- [需求框架](./requirements-framework.md)
- [Generative Agents 研究综合](../research/generative-agents-deep-synthesis.md)
- [人格系统深度分析](../research/personality-system-deep-analysis.md)
- Stanford Smallville: [generative-agents](https://github.com/joonspk-research/generative_agents) — 2D 地图 + Agent 自主行为的参考实现

---

*This PRD was created through interactive requirements gathering with quality scoring (3 rounds, 85/100) to ensure comprehensive coverage of business, functional, UX, and technical dimensions.*
